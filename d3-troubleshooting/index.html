<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>D3 Troubleshooting | Tom Ordonez</title>
<meta name="generator" content="Jekyll v4.1.0" />
<meta property="og:title" content="D3 Troubleshooting" />
<meta name="author" content="Tom Ordonez" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="D3 is a great JavaScript library for data visualization. However, like every technology, it can be annoying when you don’t know why things don’t work as expected." />
<meta property="og:description" content="D3 is a great JavaScript library for data visualization. However, like every technology, it can be annoying when you don’t know why things don’t work as expected." />
<link rel="canonical" href="https://www.tomordonez.com/d3-troubleshooting/" />
<meta property="og:url" content="https://www.tomordonez.com/d3-troubleshooting/" />
<meta property="og:site_name" content="Tom Ordonez" />
<meta property="og:image" content="https://www.tomordonez.com/assets/images/1.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-09T00:00:00-05:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://www.tomordonez.com/assets/images/1.jpg" />
<meta property="twitter:title" content="D3 Troubleshooting" />
<script type="application/ld+json">
{"@type":"BlogPosting","image":"https://www.tomordonez.com/assets/images/1.jpg","headline":"D3 Troubleshooting","dateModified":"2020-02-09T00:00:00-05:00","datePublished":"2020-02-09T00:00:00-05:00","url":"https://www.tomordonez.com/d3-troubleshooting/","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.tomordonez.com/d3-troubleshooting/"},"author":{"@type":"Person","name":"Tom Ordonez"},"description":"D3 is a great JavaScript library for data visualization. However, like every technology, it can be annoying when you don’t know why things don’t work as expected.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://www.tomordonez.com/feed.xml" title="Tom Ordonez" /><link rel="apple-touch-icon" sizes="180x180" href="/assets/fav/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/fav/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/fav/favicon-16x16.png">
  <link rel="manifest" href="/assets/fav/site.webmanifest">
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Tom Ordonez</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about.html">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">D3 Troubleshooting</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2020-02-09T00:00:00-05:00" itemprop="datePublished">Feb 9, 2020
      </time>• <span>

5 min read

</span>
    </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>D3 is a great JavaScript library for data visualization. However, like every technology, it can be annoying when you don’t know why things don’t work as expected.</p>

<p>A good way for troubleshooting D3 is by using the browser console.</p>

<p>Let’s run a small project as shown on the D3 tutorial above. It can be as simple as creating an <code class="language-plaintext highlighter-rouge">index.html</code> and linking to the <code class="language-plaintext highlighter-rouge">D3.js</code> library.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;script type="text/javascript" src="https://d3js.org/d3.v5.min.js"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre></div></div>

<p>Then run the webserver like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python -m http.server 8888 --bind 127.0.0.1
</code></pre></div></div>

<p>Open the browser on: <code class="language-plaintext highlighter-rouge">http://127.0.0.1:8888/</code>. For this test I used Firefox 72.</p>

<p>Open the console on the browser. (You can use <code class="language-plaintext highlighter-rouge">clear()</code> to clear the output)</p>

<h2 id="d3-methods">D3 Methods</h2>

<p>On the console, type <code class="language-plaintext highlighter-rouge">d3</code>. Then expand the result, which shows all these methods. Now you can investigate which methods are available:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{…}
​
__esModule: true
​
active: function active()​
arc: function arc()​
area: function ry()​
areaRadial: function ly()​
ascending: function n()​
axisBottom: function axisBottom()​
axisLeft: function axisLeft()​
axisRight: function axisRight()​
...
...
it has about 500 methods...
</code></pre></div></div>

<p>For example, two useful methods are <code class="language-plaintext highlighter-rouge">d3.min</code> and <code class="language-plaintext highlighter-rouge">d3.max</code>.</p>

<p>Let’s create an array:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>numbers = [3, 9, 1, 0, 2, 8, 2];
</code></pre></div></div>

<p>It shows this output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Array(7) [ 3, 9, 1, 0, 2, 8, 2 ]
</code></pre></div></div>

<p>Then the min and max can be easily calculated:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>d3.min(numbers)
0

d3.max(numbers)
9
</code></pre></div></div>

<p>This can be helpful when using <code class="language-plaintext highlighter-rouge">scales</code> to define the input domain.</p>

<h2 id="array-methods">Array methods</h2>

<p>Type the name of the array we created</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>numbers
</code></pre></div></div>

<p>Expand the result to see the values of the array and the array methods</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(7) […]
​0: 3
​1: 9
​2: 1
​3: 0
​4: 2
​5: 8
​6: 2
​length: 7
​
&lt;prototype&gt;: []
​​concat: function concat()
​​constructor: function Array()
​​copyWithin: function copyWithin()
​​entries: function entries()
​​every: function every()
​​fill: function fill()
​​filter: function filter()
​​find: function find()
​​findIndex: function findIndex()
​​flat: function flat()
​​flatMap: function flatMap()
​​forEach: function forEach()
​​includes: function includes()
​​indexOf: function indexOf()
​​join: function join()
​​keys: function keys()
​​lastIndexOf: function lastIndexOf()
​​length: 0
​​map: function map()
​​pop: function pop()
​​push: function push()
​​reduce: function reduce()
​​reduceRight: function reduceRight()
​​reverse: function reverse()
​​shift: function shift()
​​slice: function slice()
​​some: function some()
​​sort: function sort()
​​splice: function splice()
​​toLocaleString: function toLocaleString()
​​toSource: function toSource()
​​toString: function toString()
​​unshift: function unshift()
​​values: function values()
​​Symbol(Symbol.iterator): function values()
​​Symbol(Symbol.unscopables): Object { copyWithin: true, entries: true, fill: true, … }
​​&lt;prototype&gt;: Object { … } ​
</code></pre></div></div>

<p>There is a <code class="language-plaintext highlighter-rouge">sort</code> function.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>numbers.sort()
Array(7) [ 0, 1, 2, 2, 3, 8, 9 ]
</code></pre></div></div>

<p>There is also <code class="language-plaintext highlighter-rouge">length</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>numbers.length
7
</code></pre></div></div>

<h2 id="object-methods">Object Methods</h2>

<p>Let’s create an object.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>simpsons = { name: "Homer", age: 40, city: "Springfield"};
</code></pre></div></div>

<p>Type <code class="language-plaintext highlighter-rouge">simpsons</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Object { name: "Homer", age: 40, city: "Springfield" }
</code></pre></div></div>

<p>Create an array from this object:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>simpsonsArray = d3.values(simpsons)
Array(3) [ "Homer", 40, "Springfield" ]
</code></pre></div></div>

<p>To see methods available for <code class="language-plaintext highlighter-rouge">Object</code> simpsons, type <code class="language-plaintext highlighter-rouge">simpsons</code> and expand the output.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{…}
​age: 40
​city: "Springfield"
​name: "Homer"
​
&lt;prototype&gt;: {…}
​​__defineGetter__: function __defineGetter__()
​​__defineSetter__: function __defineSetter__()
​​__lookupGetter__: function __lookupGetter__()
​​__lookupSetter__: function __lookupSetter__()
​​__proto__: 
​​constructor: function Object()
​​hasOwnProperty: function hasOwnProperty()
​​isPrototypeOf: function isPrototypeOf()
​​propertyIsEnumerable: function propertyIsEnumerable()
​​toLocaleString: function toLocaleString()
​​toSource: function toSource()
​​toString: function toString()
​​valueOf: function valueOf()
​​&lt;get __proto__()&gt;: function __proto__()
​​&lt;set __proto__()&gt;: function __proto__()
</code></pre></div></div>

<h2 id="consolelog-on-callback-function">Console.log on callback function</h2>

<p>On your D3 script, use <code class="language-plaintext highlighter-rouge">console.log</code> on a callback function to see the data before and after such as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var someFunction (d) {
	console.log("Before something happens");
	console.log(d);
	somethingHappens(d);
	console.log("After something happens");
	console.log(d);
	}
</code></pre></div></div>

<h2 id="d3nest-reformats-a-date-object-to-string">d3.nest reformats a Date object to string</h2>

<p>As seen <a href="https://stackoverflow.com/questions/25576853/d3-nest-formatting-date-incorrectly">here</a> and <a href="https://github.com/d3/d3-collection/issues/19">here</a>.</p>

<p>If you are using <code class="language-plaintext highlighter-rouge">d3.nest()</code> to group data that has a <code class="language-plaintext highlighter-rouge">Date</code>. Nest will force the value into a string.</p>

<p>Given a dataset where you parse the year:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const parseTime = d3.timeParse("%Y");
</code></pre></div></div>

<p>After loading <code class="language-plaintext highlighter-rouge">dataset</code>, then creating an array of objects:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const data = dataset.map(d =&gt; {
	return {
	  year: parseTime(d.year),
	  count: +d.sale
	};
})
</code></pre></div></div>

<p>The parsed <code class="language-plaintext highlighter-rouge">d.year</code> stored into <code class="language-plaintext highlighter-rouge">year</code> should be like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Date Sat Jan 01 2011 00:00:00 GMT-0500 (Eastern Standard Time)
</code></pre></div></div>

<p>If you want to summarize the data and calculate amount per year:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const salesYear = d3.nest()
.key(d =&gt; d.year)
.rollup(amount =&gt; d3.sum(amount, d =&gt; d.sale))
.entries(data);
</code></pre></div></div>

<p>However, <code class="language-plaintext highlighter-rouge">.key(d =&gt; d.year)</code> forces the <code class="language-plaintext highlighter-rouge">Date</code> object to <code class="language-plaintext highlighter-rouge">String</code> like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"Sat Jan 01 2011 00:00:00 GMT-0500 (Eastern Standard Time)"
</code></pre></div></div>

<p>If you were to plot <code class="language-plaintext highlighter-rouge">Sales Amount vs Year</code> by using a scale that maps <code class="language-plaintext highlighter-rouge">Year</code> to <code class="language-plaintext highlighter-rouge">Date</code> objects. You will get a <code class="language-plaintext highlighter-rouge">NaN</code>. Because now <code class="language-plaintext highlighter-rouge">Year</code> is not a <code class="language-plaintext highlighter-rouge">Date</code> object, but a <code class="language-plaintext highlighter-rouge">String</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const line = d3.line()
   .x(d =&gt; xScale(d.year))
   .y(d =&gt; yScale(d.amount));
</code></pre></div></div>

<p>You need to convert the <code class="language-plaintext highlighter-rouge">Date string</code> back to <code class="language-plaintext highlighter-rouge">Date object</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const line = d3.line()
	.x(d =&gt; xScale(new Date(d.year)))
	.y(d =&gt; yScale(d.amount));
</code></pre></div></div>

<h2 id="d3-examples">D3 examples</h2>

<p>There are two websites that have a lot of examples. However, keep in mind some use different versions of D3, and the syntax might change in different versions:</p>

<ul>
  <li><a href="https://bl.ocks.org/">Blocks</a></li>
  <li><a href="https://observablehq.com/">Observable</a></li>
  <li><a href="https://github.com/d3/d3/wiki">Docs</a></li>
</ul>

  </div>

  
  <div>
    <h3>Related Posts</h3>
    <ul>
    
      <li><a href="/d3-tutorial-data-visualization/">D3 Tutorial for Data Visualization</a></li>
    
      <li><a href="/tableau-tutorial-visualization-co2-world-dataset/">Tableau Tutorial Visualization - CO2 World Dataset</a></li>
    
      <li><a href="/google-maps-api-python/">Google Maps API with Python</a></li>
    
      <li><a href="/data-wrangling-openrefine-linux/">Data Wrangling with OpenRefine on Linux</a></li>
    
      <li><a href="/r-tutorial-rstudio-data-analysis/">R Tutorial with Rstudio and Data Analysis</a></li>
    
    </ul>
  </div>
  <a class="u-url" href="/d3-troubleshooting/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Tom Ordonez</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">{&quot;name&quot;=&gt;&quot;Tom Ordonez&quot;}</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/tomordonez"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">tomordonez</span></a></li><li><a href="https://www.twitter.com/tomordonez"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">tomordonez</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A blog about analytics, data science, software engineering, and other thoughts.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
